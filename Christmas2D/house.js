var gl;

var colors = [];
var numVertices = 183 + 102 + 165 + 42;
var moving = 0.0;
var tmp = [];
var points = [];
var delay = 100;
var santaX = 0.0;
var santaY = 0.0;
var smoke_flag = 0;
var star_flag = 0;
var state = 0; // 0: nothing, 1: rising, 2: sinking
var santa_state = 0; //0 : nothing , 1: moving
var santa_center;
var tmpx=null;
var tmpy=null;
var iter = 1;

window.onload = function init() {
   function concatArray (arr1, arr2) {
          var vertex = new Float32Array(arr1.length + arr2.length);

          vertex.set(arr2);
          vertex.set(arr1, arr2.length);
                 
          return vertex;
      }
      
      function setVertices (star_flag) {
         
        var star_vertex_1 = new Float32Array([
               //// stars ////
               -0.9, 0.9, 0.0, 1.0, -0.7, 0.9, 0.0, 1.0, -0.8, 0.75, 0.0, 1.0,
               -0.9, 0.8, 0.0, 1.0, -0.7, 0.8, 0.0, 1.0, -0.8, 0.95, 0.0, 1.0,

               -0.7, 0.65, 0.0, 1.0, -0.6, 0.65, 0.0, 1.0, -0.65, 0.725, 0.0, 1.0,
               -0.7, 0.7, 0.0, 1.0, -0.6, 0.7, 0.0, 1.0, -0.65, 0.625, 0.0, 1.0,

               0.7, 0.65, 0.0, 1.0, 0.6, 0.65, 0.0, 1.0, 0.65, 0.725, 0.0, 1.0,
               0.7, 0.7, 0.0, 1.0, 0.6, 0.7, 0.0, 1.0, 0.65, 0.625, 0.0, 1.0,

               0.85, 0.85, 0.0, 1.0, 0.75, 0.85, 0.0, 1.0, 0.8, 0.925, 0.0, 1.0,
               0.85, 0.9, 0.0, 1.0, 0.75, 0.9, 0.0, 1.0, 0.8, 0.825, 0.0, 1.0,
               ]);
       
        var star_vertex_2 = new Float32Array([
               //// stars ////
               -0.82, 0.86, 0.0, 1.0, -0.78, 0.86, 0.0, 1.0, -0.8, 0.83, 0.0, 1.0,
               -0.82, 0.84, 0.0, 1.0, -0.78, 0.84, 0.0, 1.0, -0.8, 0.87, 0.0, 1.0,

               -0.67, 0.665, 0.0, 1.0, -0.63, 0.665, 0.0, 1.0, -0.65, 0.695, 0.0, 1.0,
               -0.67, 0.685, 0.0, 1.0, -0.63, 0.685, 0.0, 1.0, -0.65, 0.655, 0.0, 1.0,

               0.67, 0.665, 0.0, 1.0, 0.63, 0.665, 0.0, 1.0, 0.65, 0.695, 0.0, 1.0,
               0.67, 0.685, 0.0, 1.0, 0.63, 0.685, 0.0, 1.0, 0.65, 0.655, 0.0, 1.0,

               0.82, 0.865, 0.0, 1.0, 0.78, 0.865, 0.0, 1.0, 0.8, 0.895, 0.0, 1.0,
               0.82, 0.885, 0.0, 1.0, 0.78, 0.885, 0.0, 1.0, 0.8, 0.855, 0.0, 1.0,
               ]);
        
       var house_vertex = new Float32Array([
            -0.375, -0.475, 0.0, 1.0, -0.375, -0.525, 0.0, 1.0, -0.325, -0.475, 0.0, 1.0, // ball1
            -0.325, -0.525, 0.0, 1.0, -0.375, -0.525, 0.0, 1.0, -0.325, -0.475, 0.0, 1.0,

            -0.25, -0.475, 0.0, 1.0, -0.2, -0.475, 0.0, 1.0, -0.25, -0.525, 0.0, 1.0, // ball2
            -0.25, -0.525, 0.0, 1.0, -0.2, -0.475, 0.0, 1.0, -0.2, -0.525, 0.0, 1.0,

            -0.25, -0.6, 0.0, 1.0, -0.25, -0.65, 0.0, 1.0, -0.2, -0.6, 0.0, 1.0,// ball3
            -0.2, -0.65, 0.0, 1.0, -0.25, -0.65, 0.0, 1.0, -0.2, -0.6, 0.0, 1.0,

            -0.375, -0.6, 0.0, 1.0, -0.375, -0.65, 0.0, 1.0, -0.325, -0.6, 0.0, 1.0,// ball4
            -0.325, -0.65, 0.0, 1.0, -0.375, -0.65, 0.0, 1.0, -0.325, -0.6, 0.0, 1.0,

            -0.375, -0.55, 0.0, 1.0, -0.325, -0.55, 0.0, 1.0, -0.375, -0.6, 0.0, 1.0,// lease1
            -0.375, -0.6, 0.0, 1.0, -0.325, -0.55, 0.0, 1.0, -0.325, -0.6, 0.0, 1.0,

            -0.3, -0.6, 0.0, 1.0, -0.3, -0.65, 0.0, 1.0, -0.25, -0.6, 0.0, 1.0,// lease2
            -0.25, -0.65, 0.0, 1.0, -0.3, -0.65, 0.0, 1.0, -0.25, -0.6, 0.0, 1.0,

            -0.325, -0.6, 0.0, 1.0, -0.325, -0.65, 0.0, 1.0, -0.275, -0.6, 0.0, 1.0, // lease3
            -0.275, -0.65, 0.0, 1.0, -0.325, -0.65, 0.0, 1.0, -0.275, -0.6, 0.0, 1.0,

            -0.25, -0.55, 0.0, 1.0, -0.2, -0.55, 0.0, 1.0, -0.25, -0.6, 0.0, 1.0, // lease4
            -0.25, -0.6, 0.0, 1.0, -0.2, -0.55, 0.0, 1.0, -0.2, -0.6, 0.0, 1.0,

            -0.25, -0.525, 0.0, 1.0, -0.2, -0.525, 0.0, 1.0, -0.25, -0.575, 0.0, 1.0,// lease5
            -0.25, -0.575, 0.0, 1.0, -0.2, -0.525, 0.0, 1.0, -0.2, -0.575, 0.0, 1.0,


            -0.375, -0.525, 0.0, 1.0, -0.325, -0.525, 0.0, 1.0, -0.375, -0.575, 0.0, 1.0,// lease6
            -0.375, -0.575, 0.0, 1.0, -0.325, -0.525, 0.0, 1.0, -0.325, -0.575, 0.0, 1.0,

            -0.3, -0.475, 0.0, 1.0, -0.3, -0.525, 0.0, 1.0, -0.25, -0.475, 0.0, 1.0,// lease7
            -0.25, -0.525, 0.0, 1.0, -0.3, -0.525, 0.0, 1.0, -0.25, -0.475, 0.0, 1.0,

            -0.325, -0.475, 0.0, 1.0, -0.325, -0.525, 0.0, 1.0, -0.275, -0.475, 0.0, 1.0, // lease8
            -0.275, -0.525, 0.0, 1.0, -0.325, -0.525, 0.0, 1.0, -0.275, -0.475, 0.0, 1.0,


            -0.8, -0.55, 0.0, 1.0, -0.7, -0.55, 0.0, 1.0, -0.8, -0.68, 0.0, 1.0,// curtain
            -0.6, -0.55, 0.0, 1.0, -0.7, -0.55, 0.0, 1.0, -0.6, -0.68, 0.0, 1.0,

            -0.375, -0.8, 0.0, 1.0, -0.325, -0.8, 0.0, 1.0, -0.375, -0.85, 0.0, 1.0,// handle
            -0.375, -0.85, 0.0, 1.0, -0.325, -0.8, 0.0, 1.0, -0.325, -0.85, 0.0, 1.0,

            -0.4, -0.7, 0.0, 1.0, -0.2, -0.7, 0.0, 1.0, -0.4, -1, 0.0, 1.0, // door
            -0.4, -1, 0.0, 1.0, -0.2, -1, 0.0, 1.0, -0.2, -0.7, 0.0, 1.0,

            -0.8, -0.55, 0.0, 1.0, -0.8, -0.75, 0.0, 1.0, -0.6, -0.55, 0.0, 1.0,// window
            -0.8, -0.75, 0.0, 1.0, -0.6, -0.75, 0.0, 1.0, -0.6, -0.55, 0.0, 1.0,

            -0.9, -0.4, 0.0, 1.0, -0.1, -0.4, 0.0, 1.0, -0.5, -0.2, 0.0, 1.0, //roof

            -0.375, -0.15, 0.0, 1.0, -0.175, -0.4, 0.0, 1.0, -0.375, -0.4, 0.0, 1.0,// stack
            -0.375, -0.15, 0.0, 1.0, -0.175, -0.15, 0.0, 1.0, -0.175, -0.4, 0.0, 1.0,

            -0.9, -1, 0.0, 1.0, -0.9, -0.4, 0.0, 1.0, -0.1, -0.4, 0.0, 1.0, // square
            -0.9, -1, 0.0, 1.0, -0.1, -0.4, 0.0, 1.0, -0.1, -1, 0.0, 1.0
            ]);
       
       var tree_vertex = new Float32Array([
         ////tree///
            0.0, 1.0, 0.0, 1.0, -0.25, 0.7, -0.25, 1.0, -0.25, 0.7, 0.25, 1.0,
            0.0, 1.0, 0.0, 1.0, -0.25, 0.7, 0.25, 1.0, 0.25, 0.7, 0.25, 1.0,
            0.0, 1.0, 0.0, 1.0, 0.25, 0.7, 0.25, 1.0, 0.25, 0.7, -0.25, 1.0,
            0.0, 1.0, 0.0, 1.0, -0.25, 0.7, -0.25, 1.0, 0.25, 0.7, -0.25, 1.0,

            //2
            0.0, 0.9, 0.0, 1.0, -0.3, 0.5, -0.3, 1.0, -0.3, 0.5, 0.3, 1.0,
            0.0, 0.9, 0.0, 1.0, -0.3, 0.5, 0.3, 1.0, 0.3, 0.5, 0.3, 1.0,
            0.0, 0.9, 0.0, 1.0, 0.3, 0.5, 0.3, 1.0, 0.3, 0.5, -0.3, 1.0,
            0.0, 0.9, 0.0, 1.0, -0.3, 0.5, -0.3, 1.0, 0.3, 0.5, -0.3, 1.0,

            //wood
            0.1, 0.5, 0.1, 1.0, -0.1, 0.5, 0.1, 1.0, -0.1, 0.4, 0.1, 1.0,
            0.1, 0.5, 0.1, 1.0, 0.1, 0.4, 0.1, 1.0, -0.1, 0.4, 0.1, 1.0,
            0.1, 0.5, -0.1, 1.0, -0.1, 0.5, -0.1, 1.0, -0.1, 0.4, -0.1, 1.0,
            0.1, 0.5, -0.1, 1.0, 0.1, 0.4, -0.1, 1.0, -0.1, 0.4, -0.1, 1.0,
            0.1, 0.5, 0.1, 1.0, 0.1, 0.5, -0.1, 1.0, 0.1, 0.4, -0.1, 1.0,
            0.1, 0.5, 0.1, 1.0, 0.1, 0.4, 0.1, 1.0, 0.1, 0.4, -0.1, 1.0,
            -0.1, 0.5, 0.1, 1.0, -0.1, 0.5, -0.1, 1.0, -0.1, 0.4, -0.1, 1.0,
            -0.1, 0.5, 0.1, 1.0, -0.1, 0.4, 0.1, 1.0, -0.1, 0.4,- 0.1, 1.0
            ]);

       var rudolfNose_vertex_1 = new Float32Array([
          0.61, -0.64, 0.0, 1.0, 0.64, -0.64, 0.0, 1.0,  0.61, -0.665, 0.0, 1.0, //nose
             0.64, -0.64, 0.0, 1.0, 0.61, -0.665, 0.0, 1.0, 0.64, -0.665, 0.0, 1.0
          ]);

      var rudolfNose_vertex_2 = new Float32Array([
         0.62, -0.652, 0.0, 1.0, 0.63, -0.652, 0.0, 1.0, 0.62, -0.653, 0.0, 1.0, //nose
            0.63, -0.652, 0.0, 1.0, 0.62, -0.653, 0.0, 1.0, 0.63, -0.653, 0.0, 1.0
          ]);

         var rudolf_vertex = new Float32Array([
            //// rudolf ////
            0.58, -0.605, 0.0, 1.0, 0.6, -0.605, 0.0, 1.0, 0.58, -0.625, 0.0, 1.0, //left black eye
            0.6, -0.605, 0.0, 1.0, 0.58, -0.625, 0.0, 1.0, 0.6, -0.625,0.0, 1.0,

            0.65, -0.605, 0.0, 1.0, 0.67, -0.605, 0.0, 1.0, 0.65, -0.625, 0.0, 1.0, //right black eye
            0.67, -0.605, 0.0, 1.0, 0.65, -0.625, 0.0, 1.0, 0.67, -0.625, 0.0, 1.0,

            0.525, -0.5925, 0.0, 1.0, 0.55, -0.5925, 0.0, 1.0, 0.55, -0.61, 0.0, 1.0, //left pink ear

            0.7, -0.5925, 0.0, 1.0, 0.725, -0.5925, 0.0, 1.0, 0.7, -0.61, 0.0, 1.0, //right pink ear

            0.6075, -0.68, 0.0, 1.0, 0.6425, -0.68, 0.0, 1.0, 0.625, -0.69, 0.0, 1.0, //tongue

            0.57, -0.6, 0.0, 1.0, 0.61, -0.6, 0.0, 1.0, 0.57, -0.63, 0.0, 1.0, //left white eye
            0.61, -0.6, 0.0, 1.0, 0.57, -0.63, 0.0, 1.0, 0.61, -0.63, 0.0, 1.0,

            0.64, -0.6, 0.0, 1.0, 0.68, -0.6, 0.0, 1.0, 0.64, -0.63, 0.0, 1.0, //right white eye
            0.68, -0.6, 0.0, 1.0, 0.64, -0.63, 0.0, 1.0, 0.68, -0.63, 0.0, 1.0,

            0.59, -0.67, 0.0, 1.0, 0.66, -0.67, 0.0, 1.0, 0.625, -0.69, 0.0, 1.0,  //mouth

            0.55, -0.575, 0.0, 1.0, 0.7, -0.575, 0.0, 1.0, 0.55, -0.7, 0.0, 1.0, //face
            0.7, -0.575, 0.0, 1.0, 0.55, -0.7, 0.0, 1.0, 0.7, -0.7, 0.0, 1.0,

            0.625, -0.7, 0.0, 1.0, 0.875, -0.7, 0.0, 1.0, 0.625, -0.8, 0.0, 1.0, //body
            0.875, -0.7, 0.0, 1.0, 0.625, -0.8, 0.0, 1.0, 0.875, -0.8, 0.0, 1.0,

            0.875, -0.68, 0.0, 1.0, 0.915, -0.68, 0.0, 1.0, 0.875, -0.72, 0.0, 1.0, //tail
            0.915, -0.68, 0.0, 1.0, 0.875, -0.72, 0.0, 1.0, 0.915, -0.72, 0.0, 1.0,

            0.625, -0.8, 0.0, 1.0, 0.65, -0.8, 0.0, 1.0, 0.625, -0.9, 0.0, 1.0, //front leg
            0.65, -0.8, 0.0, 1.0, 0.675, -0.8, 0.0, 1.0, 0.65, -0.9, 0.0, 1.0,

            0.825, -0.8, 0.0, 1.0, 0.85, -0.8,0.0, 1.0,  0.825, -0.9, 0.0, 1.0, //rear leg
            0.85, -0.8, 0.0, 1.0, 0.875, -0.8, 0.0, 1.0, 0.85, -0.9, 0.0, 1.0,

            0.5, -0.575, 0.0, 1.0, 0.55, -0.575, 0.0, 1.0, 0.55, -0.61, 0.0, 1.0,//left ear

            0.7, -0.575, 0.0, 1.0, 0.75, -0.575, 0.0, 1.0, 0.7, -0.61, 0.0, 1.0,//right ear

            0.565, -0.45, 0.0, 1.0, 0.6, -0.45, 0.0, 1.0, 0.565, -0.575, 0.0, 1.0, //left horn
            0.6, -0.45, 0.0, 1.0, 0.565, -0.575, 0.0, 1.0, 0.6, -0.575, 0.0, 1.0,

            0.65, -0.45, 0.0, 1.0, 0.685, -0.45, 0.0, 1.0, 0.65, -0.575, 0.0, 1.0, //right horn
            0.685, -0.45, 0.0, 1.0, 0.65, -0.575, 0.0, 1.0, 0.685, -0.575, 0.0, 1.0,

            0.53, -0.485, 0.0, 1.0, 0.565, -0.485, 0.0, 1.0, 0.53, -0.52, 0.0, 1.0, //left small horn
            0.565, -0.485, 0.0, 1.0, 0.53, -0.52, 0.0, 1.0, 0.565, -0.52, 0.0, 1.0,

            0.685, -0.485, 0.0, 1.0, 0.72, -0.485, 0.0, 1.0, 0.685, -0.52, 0.0, 1.0,//right small horn
            0.72, -0.485, 0.0, 1.0, 0.685, -0.52, 0.0, 1.0, 0.72, -0.52, 0.0, 1.0,
            ]);
       
       var santa_vertex = new Float32Array([
            //// santa ////
            //boots
            -0.1, -0.7, 0.0, 1.0, -0.1, -0.9, 0.0, 1.0, 0, -0.7, 0.0, 1.0, 
            -0.1, -0.9, 0.0, 1.0, 0, -0.7, 0.0, 1.0, 0, -0.9, 0.0, 1.0, 
            0, -0.8, 0.0, 1.0, 0, -0.9, 0.0, 1.0, 0.1, -0.8, 0.0, 1.0, 
            0, -0.9, 0.0, 1.0, 0.1, -0.8, 0.0, 1.0, 0.1, -0.9, 0.0, 1.0, 
            0.2, -0.7, 0.0, 1.0, 0.2, -0.9, 0.0, 1.0, 0.3, -0.7, 0.0, 1.0, 
            0.2, -0.9, 0.0, 1.0, 0.3, -0.7, 0.0, 1.0, 0.3, -0.9, 0.0, 1.0, 
            0.3, -0.8, 0.0, 1.0, 0.3, -0.9, 0.0, 1.0, 0.4, -0.8, 0.0, 1.0, 
            0.3, -0.9, 0.0, 1.0, 0.4, -0.8, 0.0, 1.0, 0.4, -0.9, 0.0, 1.0, 

            //belt
            -0.3, -0.4, 0.0, 1.0, -0.3, -0.5, 0.0, 1.0, 0.1, -0.4, 0.0, 1.0, 
            -0.3, -0.5, 0.0, 1.0, 0.1, -0.4, 0.0, 1.0, 0.1, -0.5, 0.0, 1.0, 
            0.2, -0.4, 0.0, 1.0, 0.2, -0.5, 0.0, 1.0, 0.3, -0.4, 0.0, 1.0, 
            0.2, -0.5, 0.0, 1.0, 0.3, -0.4, 0.0, 1.0, 0.3, -0.5, 0.0, 1.0, 
            0.4, -0.4, 0.0, 1.0, 0.4, -0.5, 0.0, 1.0, 0.6, -0.4, 0.0, 1.0, 
            0.4, -0.5, 0.0, 1.0, 0.6, -0.4, 0.0, 1.0, 0.6, -0.5, 0.0, 1.0, 

            //eye_black
            -0.2, 0.6, 0.0, 1.0, -0.2, 0.4, 0.0, 1.0, 0, 0.6, 0.0, 1.0, 
            -0.2, 0.4, 0.0, 1.0, 0, 0.6, 0.0, 1.0, 0, 0.4, 0.0, 1.0, 
            0.4, 0.6, 0.0, 1.0, 0.4, 0.4, 0.0, 1.0, 0.6, 0.6, 0.0, 1.0, 
            0.4, 0.4, 0.0, 1.0, 0.6, 0.6, 0.0, 1.0, 0.6, 0.4, 0.0, 1.0, 

            //mouth
            0, 0.3, 0.0, 1.0, 0, 0.2, 0.0, 1.0, 0.3, 0.3, 0.0, 1.0, 
            0, 0.2, 0.0, 1.0, 0.3, 0.3, 0.0, 1.0, 0.3, 0.2, 0.0, 1.0, 
            //eye
            -0.3, 0.7, 0.0, 1.0, -0.3, 0.4, 0.0, 1.0, 0, 0.7, 0.0, 1.0, 
            -0.3, 0.4, 0.0, 1.0, 0, 0.7, 0.0, 1.0, 0, 0.4, 0.0, 1.0, 
            0.3, 0.7, 0.0, 1.0, 0.3, 0.4, 0.0, 1.0, 0.6, 0.7, 0.0, 1.0, 
            0.3, 0.4, 0.0, 1.0, 0.6, 0.7, 0.0, 1.0, 0.6, 0.4, 0.0, 1.0, 

            //belt_buckle
            0.1, -0.3, 0.0, 1.0, 0.1, -0.6, 0.0, 1.0, 0.4, -0.3, 0.0, 1.0, 
            0.1, -0.6, 0.0, 1.0, 0.4, -0.3, 0.0, 1.0, 0.4, -0.6, 0.0, 1.0, 

            //hat_fur
            -0.9, 0.9, 0.0, 1.0, -0.9, 0.8, 0.0, 1.0, -0.8, 0.9, 0.0, 1.0, 
            -0.9, 0.8, 0.0, 1.0, -0.8, 0.9, 0.0, 1.0, -0.8, 0.8, 0.0, 1.0, 
            -0.5, 0.9, 0.0, 1.0, -0.5, 0.7, 0.0, 1.0, 0.8, 0.9, 0.0, 1.0, 
            -0.5, 0.7, 0.0, 1.0, 0.8, 0.9, 0.0, 1.0, 0.8, 0.7, 0.0, 1.0, 
            -0.6, 0.8, 0.0, 1.0, -0.6, 0.6, 0.0, 1.0, -0.4, 0.8, 0.0, 1.0,
            -0.6, 0.6, 0.0, 1.0, -0.5, 0.6, 0.0, 1.0, -0.5, 0.7, 0.0, 1.0, 
            -0.5, 0.7, 0.0, 1.0, -0.4, 0.7, 0.0, 1.0, -0.4, 0.8, 0.0, 1.0, 
            0.7, 0.8, 0.0, 1.0, 0.9, 0.8, 0.0, 1.0, 0.9, 0.6, 0.0, 1.0, 
            0.7, 0.8, 0.0, 1.0, 0.7, 0.7, 0.0, 1.0, 0.8, 0.7, 0.0, 1.0, 
            0.8, 0.7, 0.0, 1.0, 0.8, 0.6, 0.0, 1.0, 0.9, 0.6, 0.0, 1.0, 
            //beard
            -0.6, 0.4, 0.0, 1.0, -0.6, 0, 0.0, 1.0, 0.9, 0.4, 0.0, 1.0, 
            -0.6, 0, 0.0, 1.0, 0.9, 0.4, 0.0, 1.0, 0.9, 0, 0.0, 1.0, 
            -0.4, 0, 0.0, 1.0, -0.4, -0.1, 0.0, 1.0, 0.7, 0, 0.0, 1.0, 
            -0.4, -0.1, 0.0, 1.0, 0.7, 0, 0.0, 1.0, 0.7, -0.1, 0.0, 1.0, 
            -0.2, -0.1, 0.0, 1.0, -0.2, -0.2, 0.0, 1.0, 0.5, -0.1, 0.0, 1.0,
            -0.2, -0.2, 0.0, 1.0, 0.5, -0.1, 0.0, 1.0, 0.5, -0.2, 0.0, 1.0, 
            0, -0.2, 0.0, 1.0, 0, -0.3, 0.0, 1.0, 0.3, -0.2, 0.0, 1.0, 
            0, -0.3, 0.0, 1.0, 0.3, -0.2, 0.0, 1.0, 0.3, -0.3, 0.0, 1.0, 

            //body
            -0.3, 0, 0.0, 1.0, -0.3, -0.6, 0.0, 1.0, 0.6, 0, 0.0, 1.0, 
            0.6, 0, 0.0, 1.0, -0.3, -0.6, 0.0, 1.0, 0.6, -0.6, 0.0, 1.0, 
            //hat
            -0.8, 0.9, 0.0, 1.0, -0.8, 0.8, 0.0, 1.0, -0.6, 1, 0.0, 1.0, 
            -0.6, 1, 0.0, 1.0, -0.8, 0.8, 0.0, 1.0, 0.9, 1, 0.0, 1.0, 
            -0.8, 0.8, 0.0, 1.0, 0.9, 1, 0.0, 1.0, 0.9, 0.8, 0.0, 1.0, 

            -0.6, 1, 0.0, 1.0, -0.6, 0, 0.0, 1.0, 0.9, 1, 0.0, 1.0, 
            0.9, 1, 0.0, 1.0, -0.6, 0, 0.0, 1.0, 0.9, 0, 0.0, 1.0, //face
            -0.1, -0.6, 0.0, 1.0, -0.1, -0.8, 0.0, 1.0, 0, -0.6, 0.0, 1.0, 
            -0.1, -0.8, 0.0, 1.0, 0, -0.6, 0.0, 1.0, 0, -0.8, 0.0, 1.0, 
            0.2, -0.6, 0.0, 1.0, 0.2, -0.8, 0.0, 1.0, 0.3, -0.6, 0.0, 1.0, 
            0.2, -0.8, 0.0, 1.0, 0.3, -0.6, 0.0, 1.0, 0.3, -0.8, 0.0, 1.0, //2 legs
            ]);
       
       var smoke_vertex = new Float32Array([
            //// smoke ////
            -0.35, -0.05 + moving, 0.0, 1.0, -0.3, -0.05 + moving, 0.0, 1.0, -0.35, -0.1 + moving, 0.0, 1.0,
            -0.35, -0.1 + moving, 0.0, 1.0, -0.3, -0.05 + moving, 0.0, 1.0, -0.3, -0.1 + moving, 0.0, 1.0,

            -0.225, 0 + moving, 0.0, 1.0, -0.175, 0 + moving, 0.0, 1.0, -0.225, -0.05 + moving, 0.0, 1.0,
            -0.225, -0.05 + moving, 0.0, 1.0, -0.175, 0 + moving, 0.0, 1.0, -0.175, -0.05 + moving, 0.0, 1.0,

            -0.35, 0.05 + moving, 0.0, 1.0, -0.3, 0.05 + moving, 0.0, 1.0, -0.35, 0 + moving, 0.0, 1.0,
            -0.35, 0 + moving, 0.0, 1.0, -0.3, 0.05 + moving, 0.0, 1.0, -0.3, 0 + moving, 0.0, 1.0,

            -0.15, 0.1 + moving, 0.0, 1.0, -0.1, 0.1 + moving, 0.0, 1.0, -0.15, 0.05 + moving, 0.0, 1.0,
            -0.15, 0.05 + moving, 0.0, 1.0, -0.1, 0.1 + moving, 0.0, 1.0, -0.1, 0.05 + moving, 0.0, 1.0,

            -0.35, 0.2 + moving, 0.0, 1.0, -0.3, 0.2 + moving, 0.0, 1.0, -0.35, 0.15 + moving, 0.0, 1.0,
            -0.35, 0.15 + moving, 0.0, 1.0, -0.3, 0.2 + moving, 0.0, 1.0, -0.3, 0.15 + moving, 0.0, 1.0,

            -0.2, 0.3 + moving, 0.0, 1.0, -0.15, 0.3 + moving, 0.0, 1.0, -0.2, 0.25 + moving, 0.0, 1.0,
            -0.2, 0.25 + moving, 0.0, 1.0, -0.15, 0.3 + moving, 0.0, 1.0, -0.15, 0.25 + moving, 0.0, 1.0,

            -0.2, 0.3 + moving, 0.0, 1.0, -0.15, 0.3 + moving, 0.0, 1.0, -0.2, 0.25 + moving, 0.0, 1.0,
            -0.2, 0.25 + moving, 0.0, 1.0, -0.15, 0.3 + moving, 0.0, 1.0, -0.15, 0.25 + moving, 0.0, 1.0

            ]);

         if(star_flag == 0) {
          
             vertex = concatArray ( smoke_vertex, santa_vertex );
             vertex = concatArray ( vertex, rudolf_vertex );
             vertex = concatArray ( vertex, rudolfNose_vertex_1 );
             vertex = concatArray ( vertex, tree_vertex );
             vertex = concatArray ( vertex, house_vertex );
             vertex = concatArray ( vertex, star_vertex_1 );
         }
         else if (star_flag ==1) {
              vertex = concatArray ( smoke_vertex, santa_vertex );
              vertex = concatArray ( vertex, rudolf_vertex );
              vertex = concatArray ( vertex, rudolfNose_vertex_2 );
              vertex = concatArray ( vertex, tree_vertex );
              vertex = concatArray ( vertex, house_vertex );
              vertex = concatArray ( vertex, star_vertex_2 );
         }

            var theta = -15 / 180;
            var pi = Math.PI * theta;
            
            for (var i = 135 * 4; i < (135 + 48) * 4; i++) {
               if (i % 4 == 0) {//x
                  vertex[i] += 0.4;
                  vertex[i] = vertex[i] * Math.cos(-pi) - vertex[i + 2] * Math.sin(-pi);
               }
               else if (i % 4 == 1) {//y
                  vertex[i] -= 0.5;
                  vertex[i] = vertex[i] * Math.cos(pi) - vertex[i + 1] * Math.sin(pi);
               }
               else if (i % 4 == 2) {//z
                  vertex[i] -= 0.5;
                  vertex[i] = vertex[i - 1] * Math.sin(pi) + vertex[i] * Math.cos(pi);
                  vertex[i] = vertex[i - 2] * Math.sin(-pi) + vertex[i] * Math.cos(-pi);
               }
            }
          //move Santa
               var size = 0.15;

               for (var i = 285 *4; i < 450 * 4; i++) {
                   if (i % 4 == 0) {//x
                       vertex[i] *= size;
                       vertex[i] += 0.2 ;
                       vertex[i] += santaX;
                   }
                   else if (i % 4 == 1) {//y
                       vertex[i] *= size;
                       vertex[i] -= 0.5;
                       vertex[i] +=  santaY;
                   }
                }
          santa_center = vec2(vertex[1140], vertex[1141]);

          
         return vertex;
      }
   
   var canvas = document.getElementById("gl-canvas");

   gl = WebGLUtils.setupWebGL(canvas);
   if (!gl) { alert("WebGL isn't available"); }

   document.getElementById( "bling" ).click();
   document.getElementById( "bling" ).onclick = function () {

      setTimeout(function (){

         if (star_flag == 1) {
            star_flag = 0;
         }

         else {
            star_flag = 1;
         }

         vertex = setVertices(star_flag);

         gl.changeBuffer("vPosition", vertex);

         render(vertex);
         document.getElementById( "bling" ).click();

      }, delay*2);
   };

   vertex = setVertices(star_flag);

   document.getElementById( "risingButton" ).onclick = function () {

      if (state != 2) {

        state = 1;
  
         setTimeout(function () {
            if (moving < 0.14 ) {

                     moving += 0.02;

                     vertex = setVertices(star_flag);

                      gl.changeBuffer("vPosition", vertex);

                      render(vertex);

                      document.getElementById( "risingButton" ).click();
                   }
                   else {
                      moving=0.14;
                      state = 0;   
                   }
         }, delay*2);

      }

   };


   document.getElementById( "sinkingButton" ).onclick = function () {

      if (state != 1) {
           state = 2;
           
           setTimeout(function (){
                     if (moving > 0) {
                         moving-=0.02;
                         
                         vertex = setVertices(star_flag);

                         gl.changeBuffer("vPosition", vertex);
                         console.log("here");
                         render(vertex);
                         document.getElementById( "sinkingButton" ).click();
                      }
                      else {
                         moving = 0;
                         state = 0;
                      }
           }, delay*2);

      }
   };

    canvas.addEventListener("click", function (event) {
        var t = vec2(2 * event.clientX / canvas.width - 1,
            2 * (canvas.height - event.clientY) / canvas.height - 1);
        console.log('event = ', event);

        console.log('santaX = ', tmpx);
        console.log('santaY = ', tmpy);
        if (event.clientX == 0 && event.clientY ==0) {
            setTimeout(function () {
                if (iter > 0 && iter < 5) {
                    santaX = tmpx * (iter + 1) / 5;
                    santaY = tmpy * (iter + 1) / 5;
                    vertex = setVertices(0);

                    gl.changeBuffer("vPosition", vertex);
                    render(vertex);
                    canvas.click(null, tmpx, tmpy);
                    iter++;
                    console.log(santaX);
              
                }
                else if (iter >= 5 && iter < 9) {
                    santaX = tmpx * (9-iter) / 5;
                    santaY = tmpy * (9-iter) / 5;
                    vertex = setVertices(0);

                    gl.changeBuffer("vPosition", vertex);
                    render(vertex);
                    canvas.click(null, tmpx, tmpy);
                    iter++;
                    console.log(santaX);
                }
                else if (iter == 9) {
                    santaX = 0;
                    santaY = 0;
                    vertex = setVertices(0);

                    gl.changeBuffer("vPosition", vertex);
                    render(vertex);
                    canvas.click(null, tmpx, tmpy);
                    iter++;
                }
                else {
                    iter = 0;
                    santaX = 0;
                    santaY = 0;
                    santa_state = 0;
                }
            }, delay * 2);
        }
        else if (santa_state == 0) {
           
            
            tmpx = t[0] - santa_center[0];
            tmpy = t[1] - santa_center[1];

           
            setTimeout(function () {
                if (iter >= 0 && iter < 5) {
                    santaX = tmpx * (iter + 1) / 5;
                    santaY = tmpy * (iter + 1) / 5;
                    vertex = setVertices(0);

                    gl.changeBuffer("vPosition", vertex);
                    render(vertex);
                    canvas.click(null, tmpx, tmpy);
                    iter++;
                    console.log(santaX);
                }
                else {
                    iter = 0;
                }
            }, delay * 2);
        }
        
       
      
    });

   var colorArray = [
      [1, 1, 0, 1], // star

      //// house ////
      [1, 0.1, 0.4, 1],
      [0.32, 0.49, 0.46, 1],
      [0.74902, 0.847059, 0.847059, 1], // curtain
      [0.35, 0.16, 0.14, 1], // handle
      [0.52, 0.37, 0.26, 1], // door
      [1, 1, 1, 1], // window
      [0.91, 0.76, 0.65, 1], // roof
      [0.65, 0.50, 0.39, 1], // stack
      [0.65, 0.50, 0.39, 1], // square
      
      //// tree ////
      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.8, 0.0, 0.8],  // tree

      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.8, 0.0, 0.8],  // tree
      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.8, 0.0, 0.8],  // tree

      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.8, 0.0, 0.8],  // tree

      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.6, 0.0, 1.0],  // tree

      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.6, 0.0, 1.0],  // tree


      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.6, 0.0, 1.0],  // tree

      [1.0, 1.0, 1.0, 0.1],  // snow
      [0.0, 0.6, 0.0, 1.0],  // tree

      [0.58, 0.29, 0, 1.0],// wood
      
      //// rudolf ////
     [1, 0, 0, 1], //red nose
      [0, 0, 0, 1], //black eye
      [1, 0.5, 0.5, 1], //pink ear, tongue
      [1, 1, 1, 1], //white eye
      [0.9, 0.9, 0.9, 1], //mouth
      [0.6, 0.27, 0, 0.85], //face & body
      [0.3, 0.15, 0, 1], //horn
      
      //// santa ////
      [0.647059, 0.164706, 0.164706, 1.0],//brown
      [0.0, 0.0, 0.0, 1.0],//black
      [0.74902, 0.847059, 0.847059, 1.0],//skyBlue
      [1.0, 1.0, 0.0, 1.0],//yellow
      [1.0, 1.0, 1.0, 1.0],//white
      [1, 0.2, 0.0, 1.0],//red
      [0.91, 0.76, 0.65, 1.0],//skinColor

      // TODO: 이 위에 넣어주세요
      //// smoke ////
      [0.658824, 0.658824, 0.658824, 1]// smoke
   ];

   // TODO: 맨 마지막은 smoke라고 생각하고 써야해요
   var length = [24, 24, 48, 6, 6, 6, 6, 3, 6, 6, 1,2, 1,2, 1,2, 1,2, 1,2,1,2,1,2,1,2 ,24, 6, 12, 9, 12, 3, 36, 24, 24, 36, 12, 6, 54, 15, 18, 42];

   gl.enable(gl.DEPTH_TEST);

   //  Load shaders and initialize
   var program = initShaders(gl, "vertex-shader", "fragment-shader");
   gl.useProgram(program);

   for (var i = 0; i < colorArray.length; i++) {
      for (var j = 0; j < length[i]; j++) {
         colors.push(colorArray[i]);
      }
   }

   
   //3D tree
   gl.viewport(0, 0, canvas.width, canvas.height);
   gl.clearColor(0.184314, 0.184314, 0.309804, 1.0);


   gl.changeBuffer = function(name, array) {
      // create a buffer on gpu and bind point
      var bufferId = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);
      gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);

      // Associate out shader variables with our data buffer
      // attribute variable
      var attr = gl.getAttribLocation(program, name);
      gl.vertexAttribPointer(attr, 4, gl.FLOAT, false, 0, 0);
      gl.enableVertexAttribArray(attr);
   }

   gl.changeBuffer("vPosition", vertex);
   gl.changeBuffer("vColor", flatten(colors));
   render(vertex);
   // create a buffer on gpu and bind point
};

function render(vertex) {

   // 집+나무 / 루돌프 / 산타 / 연기
   numVertices = 183 + 102 + 165 + 42;

   gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
   
   gl.drawArrays(gl.TRIANGLES, 0, numVertices);
   requestAnimFrame(render);


   // create a buffer on gpu and bind point
}
function sleep(delay) {
    var start = new Date().getTime();
    while (new Date().getTime() < start + delay);
}